name: Cancelling
on:
  workflow_run:
    workflows:
      - Workflow A
      - Workflow B
    types: [ 'requested' ]

jobs:
  cancel-dups:
    name: Cancel duplicate workflow runs
    runs-on: ubuntu-latest
    if: github.event.workflow_run.name != 'B'

    steps:
      - uses: potiuk/cancel-workflow-runs@master
        name: "Cancel duplicate workflow runs"
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          cancelMode: duplicates
          sourceRunId: ${{ github.event.workflow_run.id }}

  cancel-builds:
    name: Cancel duplicate builds
    runs-on: ubuntu-latest

    # Keep the branch part of this condition in sync with the corresponding condition in build.yml
    if: >
      github.event.workflow_run.name == 'B' && ! (
        github.event.workflow_run.head_branch == 'ðŸ™„'
      )

    steps:
      - uses: potiuk/cancel-workflow-runs@master
        name: "Cancel duplicate builds"
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          cancelMode: duplicates
          sourceRunId: ${{ github.event.workflow_run.id }}
